# Troubleshooting Guide - MicroShopik Frontend

## Общие проблемы и их решения

### 1. Проблемы с аутентификацией

#### Ошибка: "Cannot read properties of undefined (reading 'login')"
**Причина**: Неправильный импорт `useAuthStore`
**Решение**: Замените `useAuth` на `useAuthStore` во всех компонентах

```typescript
// ❌ Неправильно
import { useAuth } from '@/store/authStore';

// ✅ Правильно
import { useAuthStore } from '@/store/authStore';
```

#### Ошибка: "Token is invalid or expired"
**Причина**: JWT токен истек или недействителен
**Решение**: 
1. Выйдите из системы и войдите снова
2. Проверьте, что бэкенд работает и генерирует валидные токены
3. Убедитесь, что время на сервере синхронизировано

### 2. Проблемы с API запросами

#### Ошибка: "Network Error" или "Failed to fetch"
**Причина**: Бэкенд недоступен или неправильный URL
**Решение**:
1. Проверьте, что бэкенд запущен на порту 8080
2. Создайте файл `.env` с правильным URL:
```env
VITE_API_URL=http://localhost:8080
```
3. Перезапустите dev сервер после изменения `.env`

#### Ошибка: "CORS policy: No 'Access-Control-Allow-Origin'"
**Причина**: Проблемы с CORS на бэкенде
**Решение**: Убедитесь, что бэкенд настроен для разрешения запросов с `http://localhost:3000`

### 3. Проблемы с типами TypeScript

#### Ошибка: "Property 'createdAt' does not exist on type 'User'"
**Причина**: Несоответствие названий полей между фронтендом и бэкендом
**Решение**: Используйте snake_case названия полей:
- `createdAt` → `created_at`
- `updatedAt` → `updated_at`
- `userId` → `user_id`
- `productId` → `product_id`

#### Ошибка: "Type 'string' is not assignable to type 'number'"
**Причина**: Неправильные типы данных
**Решение**: Приведите типы к правильным значениям:
```typescript
// ❌ Неправильно
// const id = params.id; // string

// ✅ Правильно
const id = Number(params.id); // number
```

### 4. Проблемы с маршрутизацией

#### Ошибка: "Route not found" или страница не загружается
**Причина**: Неправильная настройка маршрутов
**Решение**: Проверьте файл `src/App.tsx`:
1. Убедитесь, что все импорты корректны
2. Проверьте, что пути в `<Route path="..."` правильные
3. Убедитесь, что компоненты существуют

#### Ошибка: "Protected route access denied"
**Причина**: Проблемы с проверкой ролей
**Решение**: Проверьте компонент `ProtectedRoute`:
1. Убедитесь, что пользователь аутентифицирован
2. Проверьте, что у пользователя есть нужная роль
3. Убедитесь, что роли загружаются корректно

### 5. Проблемы с состоянием

#### Ошибка: "State not updating" или компонент не перерендеривается
**Причина**: Проблемы с Zustand store
**Решение**:
1. Убедитесь, что используете правильный store: `useAuthStore()`
2. Проверьте, что состояние обновляется через правильные методы
3. Убедитесь, что компонент подписан на изменения store

### 6. Проблемы с UI компонентами

#### Ошибка: "Button component not found" или стили не применяются
**Причина**: Проблемы с импортом или CSS
**Решение**:
1. Проверьте импорты компонентов
2. Убедитесь, что Tailwind CSS работает
3. Проверьте, что все CSS классы корректны

### 7. Проблемы с чатом

#### Ошибка: "Cannot send message" или сообщения не отправляются
**Причина**: Проблемы с API чата
**Решение**:
1. Проверьте, что беседа создана
2. Убедитесь, что API эндпоинт `/conversations/{id}/messages` работает
3. Проверьте, что пользователь является участником беседы

### 8. Проблемы с продуктами

#### Ошибка: "Product not found" или детали не загружаются
**Причина**: Проблемы с API продуктов
**Решение**:
1. Проверьте, что API эндпоинт `/products/{id}` работает
2. Убедитесь, что ID продукта корректный
3. Проверьте, что продукт существует в базе данных

### 9. Проблемы с заказами

#### Ошибка: "Cannot create order" или заказы не создаются
**Причина**: Проблемы с API заказов
**Решение**:
1. Проверьте, что пользователь аутентифицирован
2. Убедитесь, что продукт доступен для покупки
3. Проверьте, что API эндпоинт `/orders` работает

### 10. Проблемы с производительностью

#### Медленная загрузка страниц
**Причина**: Большие бандлы или медленные API запросы
**Решение**:
1. Используйте React.lazy для ленивой загрузки компонентов
2. Оптимизируйте API запросы
3. Используйте кэширование для статических данных

## Диагностика проблем

### 1. Проверка консоли браузера
1. Откройте Developer Tools (F12)
2. Перейдите на вкладку Console
3. Ищите ошибки (красные сообщения)
4. Проверьте Network вкладку для API запросов

### 2. Проверка состояния приложения
1. Откройте React Developer Tools
2. Проверьте состояние компонентов
3. Убедитесь, что props передаются корректно

### 3. Проверка API
1. Используйте Postman или curl для тестирования API
2. Проверьте, что все эндпоинты возвращают правильные ответы
3. Убедитесь, что аутентификация работает

## Часто задаваемые вопросы

### Q: Почему не работает чат?
A: Убедитесь, что:
1. Бэкенд запущен и доступен
2. API эндпоинты чата работают
3. Пользователь аутентифицирован
4. Беседа создана между покупателем и продавцом

### Q: Как исправить ошибки TypeScript?
A: 
1. Проверьте все импорты
2. Убедитесь, что типы соответствуют API
3. Используйте правильные названия полей (snake_case)
4. Проверьте, что все зависимости установлены

### Q: Почему не загружаются продукты?
A: Проверьте:
1. API эндпоинт `/products` работает
2. Бэкенд возвращает данные в правильном формате
3. Нет ошибок CORS
4. Аутентификация работает корректно

### Q: Как добавить новую страницу?
A: 
1. Создайте компонент в `src/pages/`
2. Добавьте маршрут в `src/App.tsx`
3. Обновите навигацию в Header и Sidebar
4. Убедитесь, что все импорты корректны

## Полезные команды

### Очистка и переустановка
```bash
# Очистка кэша npm
npm cache clean --force

# Удаление node_modules и переустановка
rm -rf node_modules package-lock.json
npm install

# Очистка кэша Vite
rm -rf node_modules/.vite
```

### Проверка зависимостей
```bash
# Проверка устаревших пакетов
npm outdated

# Обновление пакетов
npm update

# Проверка безопасности
npm audit
```

### Сборка и проверка
```bash
# Проверка TypeScript
npx tsc --noEmit

# Проверка ESLint
npm run lint

# Сборка для продакшена
npm run build
```

## Контакты для поддержки

Если проблемы не решаются:
1. Проверьте этот guide
2. Посмотрите issues в репозитории
3. Создайте новый issue с подробным описанием проблемы
4. Приложите логи ошибок и скриншоты

## Полезные ссылки

- [React Documentation](https://react.dev/)
- [TypeScript Handbook](https://www.typescriptlang.org/docs/)
- [Tailwind CSS Documentation](https://tailwindcss.com/docs)
- [Zustand Documentation](https://github.com/pmndrs/zustand)
- [Vite Documentation](https://vitejs.dev/)
